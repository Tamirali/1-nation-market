<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1 Nation Market</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --main-color: #008080;
            --secondary-color: #333;
            --accent-color: #ff6b35;
            --light-bg: #f8f9fa;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #333;
            min-height: 100vh;
        }

        header {
            background: linear-gradient(135deg, var(--main-color) 0%, #006666 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: 32px;
            margin-bottom: 5px;
        }

        .tagline {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            font-size: 14px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 15px;
            border-radius: 20px;
        }

        .search-section {
            max-width: 800px;
            margin: 25px auto;
            padding: 0 20px;
        }

        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 15px 20px 15px 45px;
            border: 2px solid #ddd;
            border-radius: 50px;
            font-size: 16px;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--main-color);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #888;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .section-title {
            font-size: 24px;
            margin: 20px 0;
            color: var(--secondary-color);
            text-align: center;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .product-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
        }

        .product-card:hover {
            transform: translateY(-5px);
        }

        .product-img-container {
            height: 220px;
            overflow: hidden;
        }

        .product-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-content {
            padding: 20px;
        }

        .product-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .product-price {
            font-size: 22px;
            font-weight: 700;
            color: var(--main-color);
        }

        .admin-btn {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background: linear-gradient(135deg, var(--secondary-color) 0%, #000 100%);
            color: white;
            border: none;
            padding: 16px 25px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 100;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            margin: 10% auto;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            border-radius: 15px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 24px;
            color: var(--secondary-color);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            color: #999;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--main-color);
        }

        .file-upload {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            background: #fafafa;
        }

        .file-upload:hover {
            border-color: var(--main-color);
        }

        .upload-icon {
            font-size: 40px;
            color: #aaa;
            margin-bottom: 10px;
        }

        .image-preview {
            margin-top: 20px;
            text-align: center;
            display: none;
        }

        .preview-img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 10px;
            border: 2px solid #eee;
        }

        .btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--main-color) 0%, #006666 100%);
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .loading {
            text-align: center;
            padding: 40px;
            grid-column: 1 / -1;
        }

        .loading-spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 5px solid rgba(0, 128, 128, 0.2);
            border-radius: 50%;
            border-top-color: var(--main-color);
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            grid-column: 1 / -1;
            color: #666;
        }

        @media (max-width: 768px) {
            .product-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .admin-btn {
                bottom: 20px;
                right: 20px;
                padding: 14px 20px;
            }
        }

        @media (max-width: 480px) {
            .product-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-bar {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
        }
    </style>
</head>
<body>

<header>
    <h1>1 Nation Market</h1>
    <p class="tagline">‡§Ö‡§ï‡•ç‡§≤ ‡§ï‡•Ä ‡§ú‡•Ä‡§§ ‡§î‡§∞ ‡§ñ‡•Å‡§¶‡§æ ‡§ï‡•Ä ‡§§‡§≤‡§æ‡§∂ | Premium Shopping Experience</p>
    <div class="stats-bar">
        <div class="stat-item">Products: <span id="totalProducts">0</span></div>
        <div class="stat-item">Live Deals: <span id="todayDeals">5+</span></div>
        <div class="stat-item">Free Delivery</div>
    </div>
</header>

<div class="search-section">
    <div class="search-box">
        <div class="search-icon">üîç</div>
        <input type="text" id="searchInput" placeholder="Search products...">
    </div>
</div>

<div class="container">
    <div class="section-title">Featured Products</div>
    <div class="product-grid" id="product-list">
        <div class="loading">
            <div class="loading-spinner"></div>
            <p>Loading products from 1 Nation Market...</p>
        </div>
    </div>
</div>

<button class="admin-btn" onclick="openLoginModal()">
    üîí Admin Panel
</button>

<div id="loginModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Admin Login</h3>
            <button class="close-btn" onclick="closeLoginModal()">&times;</button>
        </div>
        <div class="form-group">
            <label class="form-label">Password</label>
            <input type="password" id="adminPass" class="form-input" placeholder="Enter password (tamir@lI00769)">
        </div>
        <button onclick="checkAdmin()" class="btn btn-primary">Login</button>
        <button onclick="closeLoginModal()" class="btn">Close</button>
    </div>
</div>

<div id="adminDashboard" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Add New Product</h3>
            <button class="close-btn" onclick="closeAdminDashboard()">&times;</button>
        </div>
        
        <div class="form-group">
            <label class="form-label">Product Name</label>
            <input type="text" id="pName" class="form-input" placeholder="Enter product name">
        </div>
        
        <div class="form-group">
            <label class="form-label">Price (‚Çπ)</label>
            <input type="number" id="pPrice" class="form-input" placeholder="Enter price in Rupees">
        </div>
        
        <div class="form-group">
            <label class="form-label">Product Image</label>
            <div class="file-upload" onclick="document.getElementById('pImage').click()">
                <div class="upload-icon">üìÅ</div>
                <p>Click to select an image</p>
                <p style="font-size: 12px; color: #888;">or drag & drop here</p>
                <input type="file" id="pImage" accept="image/*" style="display: none;" onchange="previewImage(event)">
            </div>
            <div class="image-preview" id="imagePreview">
                <img id="previewImg" class="preview-img" src="" alt="Preview">
                <button onclick="clearImage()" class="btn" style="margin-top: 10px;">Remove Image</button>
            </div>
        </div>
        
        <button onclick="uploadAndSave()" class="btn btn-success" id="saveBtn">
            Upload & Save Product
        </button>
        
        <button onclick="closeAdminDashboard()" class="btn btn-danger" style="margin-top: 15px;">
            Logout & Close
        </button>
    </div>
</div>

<script>
// --- ‡§∏‡§π‡•Ä Firebase Configuration (‡§®‡§Ø‡§æ ‡§µ‡§æ‡§≤‡§æ) ---
const firebaseConfig = {
    apiKey: "AIzaSyCfAv_Q7rMopLnI5OctejL_ypJu1TCfNFk", 
    authDomain: "nation-market-2.firebaseapp.com",
    projectId: "nation-market-2",
    storageBucket: "nation-market-2.firebasestorage.app",
    messagingSenderId: "185693599484",
    appId: "1:185693599484:web:6fd06fe167cb4f613f4979"
};

// Initialize Firebase
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Global variables
let isAdmin = false;
let allProducts = [];
let searchQuery = '';

// ImgBB API Key (Free Image Hosting)
const IMGBB_API_KEY = '67f67768f51a79857905d4b553e1f579';

// Initialize on page load
window.onload = function() {
    loadProducts();
    setupEventListeners();
    updateStats();
};

function setupEventListeners() {
    document.getElementById('searchInput').addEventListener('input', function(e) {
        searchQuery = e.target.value.toLowerCase();
        filterAndDisplayProducts();
    });
}

// Update statistics
function updateStats() {
    document.getElementById('totalProducts').textContent = allProducts.length;
    document.getElementById('todayDeals').textContent = allProducts.length > 5 ? '5+' : allProducts.length;
}

// Load products from Firebase
function loadProducts() {
    db.collection("products").orderBy("timestamp", "desc").onSnapshot(snapshot => {
        allProducts = [];
        snapshot.forEach(doc => {
            const data = doc.data();
            data.id = doc.id;
            allProducts.push(data);
        });
        updateStats();
        filterAndDisplayProducts();
    }, error => {
        console.error("Error loading products: ", error);
        document.getElementById("product-list").innerHTML = 
            '<div class="empty-state"><p>Error loading products. Please check your connection.</p></div>';
    });
}

function filterAndDisplayProducts() {
    const productList = document.getElementById("product-list");
    
    if (allProducts.length === 0) {
        productList.innerHTML = `
            <div class="empty-state">
                <p>No products available yet.</p>
                ${isAdmin ? '<button onclick="openAdminDashboard()" class="btn btn-primary" style="width: auto; margin-top: 20px;">Add First Product</button>' : ''}
            </div>`;
        return;
    }
    
    let filteredProducts = allProducts;
    
    // Apply search filter
    if (searchQuery) {
        filteredProducts = allProducts.filter(product => {
            return product.name.toLowerCase().includes(searchQuery) || 
                   product.price.toString().includes(searchQuery);
        });
    }
    
    if (filteredProducts.length === 0) {
        productList.innerHTML = '<div class="empty-state"><p>No products match your search.</p></div>';
        return;
    }
    
    let html = "";
    filteredProducts.forEach(product => {
        const date = product.timestamp ? 
            product.timestamp.toDate().toLocaleDateString('hi-IN') : 
            'Recently';
        
        html += `
            <div class="product-card">
                <div class="product-img-container">
                    <img src="${product.img || 'https://via.placeholder.com/400x300?text=1+Nation+Market'}" 
                         class="product-img" 
                         alt="${product.name}"
                         onerror="this.src='https://via.placeholder.com/400x300?text=1+Nation+Market'">
                </div>
                <div class="product-content">
                    <h3 class="product-name">${product.name}</h3>
                    <div class="product-price">‚Çπ${product.price}</div>
                    <div style="font-size: 12px; color: #666; margin-top: 10px;">Added: ${date}</div>
                    ${isAdmin ? `
                        <div style="margin-top: 15px;">
                            <button onclick="deleteProduct('${product.id}')" 
                                    style="background: #dc3545; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">
                                Delete
                            </button>
                        </div>
                    ` : ''}
                </div>
            </div>
        `;
    });
    productList.innerHTML = html;
}

// Admin Password Check
function checkAdmin() {
    const password = document.getElementById('adminPass').value;
    if (password === "tamir@lI00769") {
        isAdmin = true;
        closeLoginModal();
        openAdminDashboard();
        alert("Welcome to 1 Nation Market Admin Panel!");
    } else {
        alert("Incorrect password!");
    }
}

function openAdminDashboard() {
    document.getElementById('adminDashboard').style.display = 'block';
    loadProducts();
}

// --- ‡§∏‡•Å‡§ß‡§∞‡§æ ‡§π‡•Å‡§Ü Upload Function ---
async function uploadAndSave() {
    const name = document.getElementById('pName').value.trim();
    const price = document.getElementById('pPrice').value.trim();
    const fileInput = document.getElementById('pImage');
    const saveBtn = document.getElementById('saveBtn');
    
    if (!name || !price || !fileInput.files[0]) {
        alert("Please enter product name, price and select an image!");
        return;
    }

    saveBtn.disabled = true;
    saveBtn.innerHTML = "Uploading...";

    try {
        // 1. Upload image to ImgBB
        const formData = new FormData();
        formData.append('image', fileInput.files[0]);
        
        const uploadResponse = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
            method: 'POST',
            body: formData
        });

        const imgData = await uploadResponse.json();
        const imgUrl = imgData.data.url;

        // 2. Save data to Firebase
        await db.collection("products").add({
            name: name,
            price: price,
            img: imgUrl,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });

        alert("‚úÖ Product added successfully!");
        
        // Clear form
        document.getElementById('pName').value = '';
        document.getElementById('pPrice').value = '';
        clearImage();
        
        // Reload products
        loadProducts();
        
    } catch (error) {
        alert("Error: " + error.message);
        console.error("Upload error:", error);
    } finally {
        saveBtn.disabled = false;
        saveBtn.innerHTML = "Upload & Save Product";
    }
}

// Delete product
async function deleteProduct(productId) {
    if (!isAdmin) {
        alert("You need to login as admin to delete products.");
        return;
    }
    
    if (!confirm("Are you sure you want to delete this product?")) {
        return;
    }
    
    try {
        await db.collection("products").doc(productId).delete();
        alert("Product deleted successfully!");
        loadProducts();
    } catch (error) {
        alert("Error deleting product: " + error.message);
    }
}

// Image preview
function previewImage(event) {
    const input = event.target;
    const preview = document.getElementById('imagePreview');
    const previewImg = document.getElementById('previewImg');
    
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
            previewImg.src = e.target.result;
            preview.style.display = 'block';
        }
        
        reader.readAsDataURL(input.files[0]);
    }
}

// Clear image
function clearImage() {
    document.getElementById('pImage').value = '';
    document.getElementById('imagePreview').style.display = 'none';
}

// Modal functions
function openLoginModal() { 
    document.getElementById('loginModal').style.display = 'block'; 
}

function closeLoginModal() { 
    document.getElementById('loginModal').style.display = 'none'; 
    document.getElementById('adminPass').value = '';
}

function closeAdminDashboard() { 
    document.getElementById('adminDashboard').style.display = 'none'; 
    isAdmin = false;
    clearImage();
}
</script>
</body>
</html>
